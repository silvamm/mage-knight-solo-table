<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="description" content="Mage Knight Dummy Player">
    <meta name="keywords" content="mage,knight,dummy,player,app,solo,cooperative">
    <link rel="apple-touch-icon" href="content/icon.png"/>
    <link rel="icon" href="content/icon.png"/>
    <meta charset="UTF-8">
    <title>Mage Knight Solo Table</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../../mage-knight-solo-table/content/mk-dummy.css"/>
</head>
<style>
    .can-active {
        cursor: pointer;
    }

    td.app-btn {
        display: table-cell !important;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(ellipse at top left, rgba(255, 193, 7, 0.15) 0%, transparent 70%);
        pointer-events: none;
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.5s ease;
    }

    body.day-period::before {
        opacity: 1;
    }

    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(ellipse at top right, rgba(100, 149, 237, 0.15) 0%, transparent 70%);
        pointer-events: none;
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.5s ease;
    }

    body.night-period::after {
        opacity: 1;
    }

    body {
        opacity: 0;
        transition: opacity 1s ease-in;
    }

    body.loaded {
        opacity: 1;
    }

</style>
<body class="bg-dark">
<h1></h1>

<div class="container text-center">
    <div class="row mb-3">
        <div class="col">
            <div class="row">
                <div class="col">
                    <button class="app-btn" type="button" data-bs-toggle="modal" data-bs-target="#tacticsCardsModal">
                        Tactic Cards
                    </button>
                    <button class="app-btn" type="button" data-bs-toggle="offcanvas"
                            data-bs-target="#referencesOffcanvas" aria-controls="referencesOffcanvas">
                        References
                    </button>
                    <button class="app-btn" type="button" data-bs-toggle="offcanvas"
                            data-bs-target="#logsOffcanvas" aria-controls="logsOffcanvas">
                        Logs
                    </button>
                    <button class="app-btn" type="button" data-bs-toggle="offcanvas"
                            data-bs-target="#dummyPlayerOffcanvas" aria-controls="dummyPlayerOffcanvas">
                        Dummy Player
                    </button>
                    <button id="reset-table-button" class="app-btn" type="button">
                        Reset
                    </button>
                    <a href="https://www.paypal.com/donate/?hosted_button_id=YWV3U9HL8BJ2J" class="app-btn">
                        Donate
                    </a>
                </div>
            </div>

            <div class="offcanvas offcanvas-bottom bg-dark text-white" tabindex="-1" id="logsOffcanvas"
                 aria-labelledby="logsOffcanvasLabel">
                <div class="offcanvas-body">
                    <div id="logs"></div>
                </div>
            </div>

            <div class="offcanvas offcanvas-end bg-dark" style="width: 30%" tabindex="-1" id="dummyPlayerOffcanvas"
                 aria-labelledby="dummyPlayerOffcanvasLabel">
                <div class="offcanvas-body">
                    <div class="row text-white">
                        <div class="col">
                            <div id="reset-button" data-bs-theme="dark">
                                <button type="button" class="btn-close" aria-label="Close"></button>
                            </div>
                            <div id="screen1">
                                <div>Select a character</div>
                                <div id="character-select">
                                    <button class="app-btn">
                                        <div id="char1" title="Norowas">Norowas</div>
                                    </button>
                                    <button class="app-btn">
                                        <div id="char2" title="Tovak">Tovak</div>
                                    </button>
                                    <button class="app-btn">
                                        <div id="char3" title="Goldyx">Goldyx</div>
                                    </button>
                                    <button class="app-btn">
                                        <div id="char4" title="Arythea">Arythea</div>
                                    </button>
                                    <button class="app-btn">
                                        <div id="char5" title="Wolfhawk">Wolfhawk</div>
                                    </button>
                                    <button class="app-btn">
                                        <div id="char6" title="Braevalar">Braevalar</div>
                                    </button>
                                    <button class="app-btn">
                                        <div id="char7" title="Krang">Krang</div>
                                    </button>
                                </div>
                            </div>
                            <div id="screen2">
                                <h1 id="character-name">Character</h1>
                                <div id="character-group">
                                    <div id="portrait"></div>
                                    <div id="crystal-area">
                                        <div id="red-count" class="red-crystal" title="Red Crystals">0</div>
                                        <div id="green-count" class="green-crystal" title="Green Crystals">0</div>
                                        <div id="blue-count" class="blue-crystal" title="Blue Crystals">0</div>
                                        <div id="white-count" class="white-crystal" title="White Crystals">0</div>
                                    </div>
                                </div>
                                <hr/>
                                <div id="card-area">
                                    <div>Cards Remaining</div>
                                    <div id="card-count">0</div>
                                    <div id="card-history">
                                        <div>
                                            <div class="red-card"></div>
                                            <div class="green-card"></div>
                                        </div>
                                        <div>
                                            <div class="blue-card"></div>
                                            <div class="white-card"></div>
                                        </div>

                                    </div>
                                </div>
                                <div class="btn-group" role="group" aria-label="Basic outlined example">
                                    <button class="app-btn" id="play-turn-button" title="Play Turn">PLAY TURN</button>
                                    <button class="app-btn" id="end-round-button" title="End Round">END ROUND</button>
                                </div>
                            </div>
                            <div id="screen3">
                                <h1>Add Mana Crystal</h1>
                                <div>Choose a crystal to add.</div>
                                <div id="new-crystal-select">
                                    <div id="new-mana-red" class="app-btn red-crystal" title="Red"></div>
                                    <div id="new-mana-green" class="app-btn green-crystal" title="Green"></div>
                                    <div id="new-mana-blue" class="app-btn blue-crystal" title="Blue"></div>
                                    <div id="new-mana-white" class="app-btn white-crystal" title="White"></div>
                                </div>
                            </div>
                            <div id="screen4">
                                <h1>Add New Card</h1>
                                <div>Choose a card to add.</div>
                                <div id="new-card-select">
                                    <div id="new-card-red" class="app-btn red-card" title="Red"></div>
                                    <div id="new-card-green" class="app-btn green-card" title="Green"></div>
                                    <div id="new-card-blue" class="app-btn blue-card" title="Blue"></div>
                                    <div id="new-card-white" class="app-btn white-card" title="White"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="offcanvas offcanvas-start text-start bg-dark" style="width: 37%" tabindex="-1"
                 id="referencesOffcanvas"
                 aria-labelledby="referencesOffcanvasLabel">
                <div id="canvasBody" class="offcanvas-body ">
                    <div class="accordion accordion-flush " id="accordionReferences">
                        <script>
                            let references = [
                                'ancient_ruins',
                                'city',
                                'combat',
                                'crystal_mines',
                                'enemy_abilities_-_defensive',
                                'enemy_abilities_-_ofensive',
                                'draconum',
                                'dungeon',
                                'end_turn',
                                'glade',
                                'grounds',
                                'keep',
                                'mage_tower',
                                'magical_glade',
                                'monastery',
                                'monster_den',
                                'orcs',
                                'round',
                                'skills_-_Arythea',
                                'skills_-_Goldyx',
                                'skills_-_Norowas',
                                'skills_-_Tovak',
                                'spawning_grounds',
                                'tomb',
                                'village'
                            ]

                            let i = 1
                            references.forEach(reference => {
                                reference_without_underscore = reference.replaceAll('_', ' ')
                                capitalize = reference_without_underscore.charAt(0).toUpperCase() + reference_without_underscore.slice(1)
                                document.write(`
                                      <div class="accordion-item bg-dark">
                                            <h2 class="">
                                                <button class="collapsed bg-dark text-white text-start app-btn" style="width: 100%" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${i}" aria-expanded="true" aria-controls="collapse${i}">
                                                    ${capitalize}
                                                </button>
                                            </h2>
                                            <div id="collapse${i}" class="accordion-collapse collapse" data-bs-parent="#accordionReferences">
                                                <div class="accordion-body">
                                                    <img src="references/${reference}.png" class="img-fluid" alt="">
                                                </div>
                                            </div>
                                      </div>
                                    `)
                                i++
                            })
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
             <div id="reminders" class="text-white app-btn" onclick="tableState.clearReminders()"></div>
        </div>
    </div>
    <div class="row ">
        <div class="col">
            <div class="table-responsive">
                <table class="table table-dark table-borderless">
                    <thead>
                    <tr>
                        <th scope="col" class="col-1" style="font-size: 25px">☼</th>
                        <th scope="col" class="col-1" style="font-size: 25px">☽</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td id="day-score">0</td>
                        <td id="night-score">0</td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <table id="moves-table" class="table table-dark table-borderless">
                                <thead>
                                <tr>
                                    <th scope="col" class="col-1">Plains</th>
                                    <th scope="col" class="col-1">Hills</th>
                                    <th scope="col" class="col-1">Forest</th>
                                    <th scope="col" class="col-1">Desert</th>
                                    <th scope="col" class="col-1">Wastelands</th>
                                    <th scope="col" class="col-1">Marsh</th>
                                    <th scope="col" class="col-1">City</th>
                                    <th scope="col" class="col-1">Mountain</th>
                                    <th scope="col" class="col-1">Water</th>
                                </tr>
                                </thead>
                                <tr id="day-move-points">
                                    <td>2</td>
                                    <td>3</td>
                                    <td>3</td>
                                    <td>5</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>2</td>
                                    <td>X</td>
                                    <td>X</td>
                                </tr>
                                <tr id="night-move-points">
                                    <td>2</td>
                                    <td>3</td>
                                    <td>5</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>2</td>
                                    <td>X</td>
                                    <td>X</td>
                                </tr>
                            </table>
                        </td>
                    </tbody>
                </table>
            </div>

            <hr class="text-white"/>

            <div class="table-responsive">
                <table class="table table-dark table-borderless ">
                    <thead>
                    <tr>
                        <th colspan="99">Reputation</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="99">
                            <div class="btn-group mb-3" role="group" aria-label="Basic outlined example">
                                <button type="button" class="app-btn"
                                        onclick="tableState.updateReputation(-1)">-1
                                </button>
                                <button type="button" class="app-btn"
                                        onclick="tableState.updateReputation(+1)">+1
                                </button>
                                <button type="button" class="app-btn"
                                        onclick="tableState.updateReputation(+2)">+2
                                </button>
                            </div>
                        </td>
                    </tr>
                    <script>
                        document.write('<tr>');
                        let reputations = [
                            {text: "X", value: -7},
                            {text: "-5", value: -6},
                            {text: "-3", value: -5},
                            {text: "-2", value: -4},
                            {text: "-1", value: -3},
                            {text: "-1", value: -2},
                            {text: "0", value: -1},
                            {text: "0", value: 0},
                            {text: "0", value: 1},
                            {text: "+1", value: 2},
                            {text: "+1", value: 3},
                            {text: "+2", value: 4},
                            {text: "+2", value: 5},
                            {text: "+3", value: 6},
                            {text: "+5", value: 7}
                        ];
                        for (let i = 0; i < reputations.length; i++) {
                            document.write(`<td class="can-active app-btn" style="width: 6.6%" data-value="${reputations[i].value}" id="reputation|${reputations[i].value}" onclick="tableState.markReputationTracker(this)">${reputations[i].text}</td>`);
                        }
                        document.write('</tr>');
                    </script>
                    </tbody>
                </table>
                x
            </div>

            <hr class="text-white"/>

            <div class="table-responsive">
                <table class="table table-dark table-borderless">
                    <thead>
                    <tr>
                        <th colspan="99">Fame</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="99">
                            <div class="btn-group mb-3" role="group" aria-label="Basic outlined example">
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+1)">
                                    +1
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+2)">
                                    +2
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+3)">
                                    +3
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+4)">
                                    +4
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+5)">
                                    +5
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+6)">
                                    +6
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+7)">
                                    +7
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+8)">
                                    +8
                                </button>
                                <button type="button" class="app-btn" onclick="tableState.updateFame(+9)">
                                    +9
                                </button>
                            </div>
                        </td>
                    </tr>
                    <script>
                        let number = 0;
                        for (let row = 1; number <= 119; row++) {
                            document.write('<tr>');
                            if (row % 2 === 1) {
                                document.write(`<td class="level-up-symbol" data-leveluprow=${row} data-symbol="command-token" style="font-size: 20px" ">⬡</td>`);

                            } else {
                                document.write(`<td class="level-up-symbol" data-leveluprow=${row} data-symbol="skills" style="font-size: 20px">▯▭</td>`);
                            }
                            for (let col = 0; col < 3 + (row - 1) * 2 && number <= 119; col++) {

                                document.write(`<td class="can-active app-btn" data-leveluprow=${row} id="fame|${number}" onclick="tableState.markFameTracker(this)">${number}</td>`);
                                number++;
                            }
                            document.write('</tr>');
                        }
                    </script>
                    </tbody>
                </table>
            </div>

        </div>

    </div>
</div>

<!-- Tactics Cards Modal -->
<div class="modal fade" id="tacticsCardsModal" tabindex="-1" aria-labelledby="tacticsCardsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark rounded-0 ">
            <div class="modal-body ">
                <div id="tactic-day-cards">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="day-1" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Early Bird</div>
                                <div class="card-body">
                                    <h5 class="card-title">1</h5>
                                    <button class="app-btn d-none" id="choose-day-1" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="day-2" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Rethink</div>
                                <div class="card-body">
                                    <h5 class="card-title">2</h5>
                                    <p class="card-text">Whe you take this Tactic, discard up to 3 cards (including Wounds) from your hand, then draw that many cards. Shuffle your discard pile back into your Deed deck.</p>
                                    <button class="app-btn d-none" id="choose-day-2" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="day-3" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Mana Steal</div>
                                <div class="card-body">
                                    <h5 class="card-title">3</h5>
                                    <p class="card-text">When you take this Tactic, take one mana die of a basic color form the Source and put it on this card. You can use that mana on any of your turns this Day. If you do, reroll it at the end of that turn and return it to the Source.</p>
                                    <button class="app-btn d-none" id="choose-day-3" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="day-4" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Planning</div>
                                <div class="card-body">
                                    <h5 class="card-title">4</h5>
                                    <p class="card-text">At the end of each turn, if you have at least two cards in your hand before you draw, draw up to your hand size and then draw an additional card.</p>
                                    <button class="app-btn d-none" id="choose-day-4" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="day-5" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Great Start</div>
                                <div class="card-body">
                                    <h5 class="card-title">5</h5>
                                    <p class="card-text">When you take this Tactic, immediately draw 2 cards.</p>
                                    <button class="app-btn d-none" id="choose-day-5" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="day-6" onclick="tableState.selectTactic(this)">
                                <div class="card-header">The Right Moment</div>
                                <div class="card-body">
                                    <h5 class="card-title">6</h5>
                                    <p class="card-text">One time this Day during your turn, you can announce that you will take another turn immediately after this. If you do, flip this card face down.</p>
                                    <button class="app-btn d-none" id="choose-day-6" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="tactic-night-cards">
                    <h6 class="text-center mb-3">Night Tactics</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="night-1" onclick="tableState.selectTactic(this)">
                                <div class="card-header">From the dusk</div>
                                <div class="card-body">
                                    <h5 class="card-title">1</h5>
                                    <button class="app-btn d-none" id="choose-night-1" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="night-2" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Long night</div>
                                <div class="card-body">
                                    <h5 class="card-title">2</h5>
                                    <p class="card-text">One time this Night, if your Deed deck is empty, you may shuffle your discard pile and put 3 cards at random back into your Deed deck. Then flip this card face down.</p>
                                    <button class="app-btn d-none" id="choose-night-2" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="night-3" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Mana Search</div>
                                <div class="card-body">
                                    <h5 class="card-title">3</h5>
                                    <p class="card-text">Once per turn, before you use mana from the Source, you may reroll up to two mana dice in the Source. When choosing dice to reroll, you must pick gold (depleted) dice first, if there are any.</p>
                                    <button class="app-btn d-none" id="choose-night-3" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="night-4" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Midnight Medidation</div>
                                <div class="card-body">
                                    <h5 class="card-title">4</h5>
                                    <p class="card-text">One time this Night, before any of your turns, you may shuffle up to 5 cards (including Wounds) from your hand back into your Deed deck and then draw that many cards. Then, flip this card face down.</p>
                                    <button class="app-btn d-none" id="choose-night-4" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="night-5" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Preparation</div>
                                <div class="card-body">
                                    <h5 class="card-title">5</h5>
                                    <p class="card-text">When you take this Tactic, search your deck for any one card and put it in your hand, then shuffle your deck.</p>
                                    <button class="app-btn d-none" id="choose-night-5" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-bg-dark app-btn h-100" id="night-6" onclick="tableState.selectTactic(this)">
                                <div class="card-header">Sparing power</div>
                                <div class="card-body">
                                    <h5 class="card-title">6</h5>
                                    <p class="card-text">Once before the start of each of your turns, choose one: Put the top card of your Deed deck face down under this card, or flip this card face down and put all Deed cards under it into your hand.</p>
                                    <button class="app-btn d-none" id="choose-night-6" onclick="tableState.chooseDummyTacticCard()">Choose Dummy Player Card</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
<script type="text/javascript" src="../../mage-knight-solo-table/code/mk-dummy.js"></script>
<script type="text/javascript" src="../../mage-knight-solo-table/code/table-state.js"></script>
<script>
    let tableState = new TableState()
    tableState.initialize()

    let context = new UIContext();

    // Fade in effect when everything is loaded
    window.addEventListener('load', function() {
        document.body.classList.add('loaded');
    });
</script>
</body>
</html>